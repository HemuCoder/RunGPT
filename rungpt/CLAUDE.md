# RunGPT æ¡†æ¶æ¶æ„æ–‡æ¡£

## æ¦‚è¿°

RunGPT æ˜¯ä¸€ä¸ªè½»é‡çº§ã€æ¨¡å—åŒ–çš„ AI Agent æ¡†æ¶,æ”¯æŒå¤šç§æ¨ç†æ¨¡å¼å’Œå·¥å…·è°ƒç”¨ã€‚

## ç›®å½•ç»“æ„

```
rungpt/
â”œâ”€â”€ agent/              # Agent å®ç°
â”‚   â”œâ”€â”€ parsers/       # è§£æå™¨ç­–ç•¥æ¨¡å¼
â”‚   â”œâ”€â”€ agent_base.py  # Agent æŠ½è±¡åŸºç±»
â”‚   â”œâ”€â”€ react_agent.py # ReAct æ¨ç† Agent
â”‚   â”œâ”€â”€ simple_agent.py # ç®€å•å¯¹è¯ Agent
â”‚   â”œâ”€â”€ plan_execute_agent.py # Plan-Execute æ¨ç† Agent
â”‚   â””â”€â”€ structured_output.py # Pydantic ç»“æ„åŒ–è¾“å‡ºç®¡ç†å™¨
â”œâ”€â”€ tools/             # å·¥å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ tool.py        # å·¥å…·å®šä¹‰
â”‚   â”œâ”€â”€ registry.py    # å·¥å…·æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ result.py      # æ ‡å‡†åŒ–è¿”å›å¯¹è±¡
â”‚   â”œâ”€â”€ schema.py      # Schema æå–
â”‚   â””â”€â”€ validators.py  # å‚æ•°éªŒè¯
â”œâ”€â”€ threads/           # å¯¹è¯çº¿ç¨‹ç®¡ç†
â”‚   â”œâ”€â”€ thread.py      # å¯¹è¯çº¿ç¨‹
â”‚   â””â”€â”€ memory_manager.py # è®°å¿†ç®¡ç†
â”œâ”€â”€ models/            # æ¨¡å‹æ¥å£
â”‚   â”œâ”€â”€ model_interface.py # æ¨¡å‹æŠ½è±¡æ¥å£
â”‚   â”œâ”€â”€ unified_provider.py # ç»Ÿä¸€æ¨¡å‹æä¾›è€…
â”‚   â””â”€â”€ model_registry.py # æ¨¡å‹æ³¨å†Œè¡¨
â””â”€â”€ context/           # ä¸Šä¸‹æ–‡ç®¡ç†
    â”œâ”€â”€ context_manager.py # ä¸Šä¸‹æ–‡ç®¡ç†å™¨
    â”œâ”€â”€ prompt_template.py # æç¤ºè¯æ¨¡æ¿
    â”œâ”€â”€ tool_injector.py # å·¥å…·æ³¨å…¥å™¨
    â””â”€â”€ skill_injector.py # æŠ€èƒ½æ³¨å…¥å™¨
```

## æ ¸å¿ƒæ¨¡å—

### Agent æ¨¡å—

**èŒè´£**: å®ç°ä¸åŒæ¨ç†æ¨¡å¼çš„ AI Agent

**å…³é”®è®¾è®¡**:
- `AgentBase`: æŠ½è±¡åŸºç±»,å®šä¹‰ Agent é€šç”¨æ¥å£
- ç­–ç•¥æ¨¡å¼: ä¸åŒ Agent å®ç°ä¸åŒæ¨ç†ç­–ç•¥
- æ¨¡æ¿æ–¹æ³•: `_execute` ç”±å­ç±»å®ç°å…·ä½“é€»è¾‘

**æ¨ç†æ¨¡å¼**:
- `SimpleAgent`: å•è½®å¯¹è¯,æ— å·¥å…·è°ƒç”¨
- `ReActAgent`: Think â†’ Act â†’ Observe å¾ªç¯,æ”¯æŒå·¥å…·è°ƒç”¨
- `PlanExecuteAgent`: Plan â†’ Execute â†’ Summarize å¾ªç¯,é€‚åˆå¤æ‚ä»»åŠ¡åˆ†è§£

**è®¾è®¡æ¼”è¿›**:
- âŒ æ—§è®¾è®¡: Plan å’Œ Execute åˆ†ç¦»ä¸ºä¸¤ä¸ª Agent,éœ€è¦æ‰‹åŠ¨ä¸²è”
- âœ… æ–°è®¾è®¡: `PlanExecuteAgent` ç»Ÿä¸€æ¨ç†å¾ªç¯,ç±»ä¼¼ ReAct çš„å®Œæ•´æ€§
- ç†å¿µ: æ¨ç†æ¨¡å¼åº”è¯¥æ˜¯å®Œæ•´çš„å¾ªç¯,è€Œéç¢ç‰‡åŒ–çš„ç»„ä»¶

**æœ€è¿‘ä¼˜åŒ–**:
- **Pydantic ç»“æ„åŒ–è¾“å‡º (v0.2.0)**: æ‰€æœ‰ Agent æ”¯æŒ `response_model` å‚æ•°,è¿”å›å¼ºç±»å‹ Pydantic å¯¹è±¡
- PlanExecuteAgent åˆå¹¶: å°† Planner + Executor åˆå¹¶ä¸ºç»Ÿä¸€çš„æ¨ç†æ¨¡å¼
- ReActAgent æ–¹æ³•æ‹†åˆ†: `_execute` â†’ `_execute_step`, `_handle_action`, `_handle_finish`, `_handle_error`, `_force_finish`
- è§£æå™¨é‡æ„: ä» 279 è¡Œå•æ–‡ä»¶é‡æ„ä¸ºç­–ç•¥æ¨¡å¼,4 ä¸ªä¸“ç”¨è§£æå™¨ + ç®¡ç†å™¨

**ç»“æ„åŒ–è¾“å‡º**:
- `structured_output.py`: ç®¡ç† Pydantic Schema æ³¨å…¥å’Œ JSON è§£æ
- `StructuredOutputManager`: è´Ÿè´£ç”Ÿæˆæ ¼å¼è¯´æ˜ã€è§£æ LLM è¾“å‡ºã€éªŒè¯ Pydantic å¯¹è±¡
- å®ç°ç­–ç•¥: Prompt Engineering (æ³¨å…¥ JSON Schema) + JSON è§£æ + Pydantic éªŒè¯
- å‘åå…¼å®¹: `response_model` ä¸ºå¯é€‰å‚æ•°,ä¸ä¼ åˆ™è¿”å› `str`

### è§£æå™¨æ¨¡å— (`agent/parsers/`)

**èŒè´£**: è§£æ LLM è¾“å‡º,æå–ç»“æ„åŒ– Action

**æ¶æ„**: ç­–ç•¥æ¨¡å¼
- `ParserStrategy`: æŠ½è±¡åŸºç±»
- `BracketFormatParser`: å¤„ç† `tool[params]` æ ¼å¼
- `FunctionCallParser`: å¤„ç† `tool(params)` æ ¼å¼
- `JSONActionParser`: å¤„ç† JSON ä»£ç å—
- `RobustActionParser`: æ¨¡ç³ŠåŒ¹é…å’Œä¿®å¤(å…œåº•)
- `ParserManager`: ç­–ç•¥ç¼–æ’å™¨,æŒ‰ä¼˜å…ˆçº§å°è¯•

**ä¼˜åŠ¿**:
- å¼€é—­åŸåˆ™: æ–°å¢æ ¼å¼åªéœ€æ·»åŠ æ–°ç­–ç•¥
- å•ä¸€èŒè´£: æ¯ä¸ªè§£æå™¨ä¸“æ³¨ä¸€ç§æ ¼å¼
- å¯æµ‹è¯•æ€§: ç‹¬ç«‹æµ‹è¯•æ¯ä¸ªç­–ç•¥

### å·¥å…·æ¨¡å—

**èŒè´£**: å·¥å…·å®šä¹‰ã€æ³¨å†Œã€è°ƒç”¨ã€éªŒè¯

**å…³é”®ç»„ä»¶**:
- `Tool`: å·¥å…·å®šä¹‰,æ”¯æŒ Pydantic éªŒè¯
- `ToolRegistry`: å·¥å…·æ³¨å†Œè¡¨,æ”¯æŒè£…é¥°å™¨æ³¨å†Œ
- `ToolResult`: æ ‡å‡†åŒ–è¿”å›å¯¹è±¡ (å¼ºåˆ¶ä½¿ç”¨)
- `schema.py`: è‡ªåŠ¨æå–å‡½æ•°ç­¾å

**æœ€è¿‘ä¼˜åŒ–**:
- å¼ºåˆ¶ ToolResult: ç§»é™¤è‡ªåŠ¨åŒ…è£…é€»è¾‘,æ‰€æœ‰å·¥å…·å¿…é¡»è¿”å› `ToolResult.ok()` æˆ– `ToolResult.fail()`
- æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ: ä¸å†æœ‰ 3 å±‚ if-else åˆ¤æ–­è¿”å›å€¼ç±»å‹

### çº¿ç¨‹æ¨¡å—

**èŒè´£**: ç®¡ç†å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡

**è®¾è®¡**:
- è½»é‡çº§: ä»…ç»´æŠ¤æ¶ˆæ¯åˆ—è¡¨,ä¸ä¾èµ–å¤–éƒ¨å­˜å‚¨
- çµæ´»æ€§: æ”¯æŒå…ƒæ•°æ®å­˜å‚¨
- åºåˆ—åŒ–: å¯å¯¼å‡º/æ¢å¤ä¸ºå­—å…¸

### æ¨¡å‹æ¨¡å—

**èŒè´£**: ç»Ÿä¸€ä¸åŒ LLM æä¾›å•†çš„æ¥å£

**æ¶æ„**:
- `ModelInterface`: æŠ½è±¡æ¥å£
- `UnifiedProvider`: ç»Ÿä¸€å®ç°,æ”¯æŒ OpenAI/Anthropic/Google ç­‰
- `ModelRegistry`: æ¨¡å‹æ³¨å†Œè¡¨

## è®¾è®¡åŸåˆ™

### 1. æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µ
- âŒ å: å¤šä¸ª if-else å¤„ç†è¾¹ç•Œæƒ…å†µ
- âœ… å¥½: é€šè¿‡è®¾è®¡è®©è¾¹ç•Œè‡ªç„¶èå…¥å¸¸è§„

### 2. å®ç”¨ä¸»ä¹‰
- å…ˆå†™æœ€ç®€å•èƒ½è¿è¡Œçš„å®ç°
- é¿å…è¿‡åº¦å·¥ç¨‹å’Œç†è®ºå®Œç¾

### 3. ç®€æ´æ€§
- å‡½æ•°ä¸è¶…è¿‡ 20 è¡Œ
- ä¸è¶…è¿‡ 3 å±‚ç¼©è¿›
- æ–‡ä»¶ä¸è¶…è¿‡ 800 è¡Œ

### 4. å•ä¸€èŒè´£
- æ¯ä¸ªç±»/å‡½æ•°åªåšä¸€ä»¶äº‹
- é«˜å†…èš,ä½è€¦åˆ

## æœ€è¿‘é‡æ„æ€»ç»“

### P0 æ¶æ„çº§ä¼˜åŒ– âœ…
1. **è§£æå™¨ç­–ç•¥æ¨¡å¼**: 279 è¡Œ â†’ 72 è¡Œä¸»æ–‡ä»¶ + 5 ä¸ªç­–ç•¥ç±»
2. **Agent æ–¹æ³•æ‹†åˆ†**: 164 è¡Œ `_execute` â†’ 5 ä¸ªèŒè´£å•ä¸€çš„æ–¹æ³•
3. **ToolResult å¼ºåˆ¶**: ç§»é™¤è‡ªåŠ¨åŒ…è£…,ç»Ÿä¸€è¿”å›ç±»å‹

### P1 ä»£ç è´¨é‡ ğŸ”„
1. **æ¶ˆé™¤é‡å¤**: åˆå¹¶ `parser_utils.py` åˆ°ç­–ç•¥æ¨¡å¼ âœ…
2. **ç®€åŒ–ç±»å‹æ˜ å°„**: å¾…ä¼˜åŒ–
3. **å‚æ•°å¯¹è±¡åŒ–**: å¾…ä¼˜åŒ–

### P2 å·¥ç¨‹å®è·µ ğŸ”„
1. **æ¶æ„æ–‡æ¡£**: æœ¬æ–‡ä»¶
2. **æ–‡ä»¶ç»„ç»‡**: åˆ›å»º `parsers/` å­æ¨¡å— âœ…
3. **è¿ç§»æŒ‡å—**: å¾…åˆ›å»º

## è¿ç§»æŒ‡å—

### å·¥å…·å‡½æ•°è¿ç§»

**æ—§ç‰ˆæœ¬**:
```python
def my_tool(param: str) -> str:
    return "result"
```

**æ–°ç‰ˆæœ¬**:
```python
from rungpt.tools import ToolResult

def my_tool(param: str) -> ToolResult:
    return ToolResult.ok("result")
    # æˆ–é”™è¯¯æƒ…å†µ
    # return ToolResult.fail("error message")
```

### è§£æå™¨ä½¿ç”¨

**æ—§ç‰ˆæœ¬**:
```python
from rungpt.agent.react_parser import ReActParser
parser = ReActParser()
action = parser.parse(text)
```

**æ–°ç‰ˆæœ¬** (å‘åå…¼å®¹):
```python
from rungpt.agent.react_parser import ReActParser
parser = ReActParser()
action = parser.parse(text)  # å†…éƒ¨ä½¿ç”¨ç­–ç•¥æ¨¡å¼
```

---

**ç»´æŠ¤è€…**: RunGPT Team  
**æœ€åæ›´æ–°**: 2025-11-27  
**ç‰ˆæœ¬**: 2.0 (ç­–ç•¥æ¨¡å¼é‡æ„ç‰ˆ)
